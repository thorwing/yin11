<%= stylesheet_link_tag "upload" %>

<% title t("desires.desire") %>

<div id="desire_fields">
    <%= form_for @desire do |f| %>
        <%= render "shared/error_messages", target: @desire %>

        <span><%= "描绘一下这东西有多诱人吧：" %></span><br/>
        <%= f.text_area :content, :maxlength => get_max_length(@desire, :content), 'data-comment_max_len' => get_max_length(@desire, :content), :class => "char_aware", rows: 8 %>
        <%= content_tag :span, "", class: "char_saver display_none" %>
        <%= content_tag :span, "", class: "char_counter block trivial" %>
        <div>
            <span class="fl mr5">添加：</span>
            <!--image uploader-->
            <div class = "fl">
                <%= hidden_field_tag "authenticity_token", form_authenticity_token, :id => "tokentag" %>
                <div id="uploader" class="fl mr10"></div>
                <div id="upload_spinner" style="display:none" ><%= image_tag "loading_big.gif", width: 24, height: 24 %></div>
            </div>
        </div>
        <div id="images_container" class="block fl m5" >
            <% @desire.images.each do |image| %>
                <div class="image fl">
                    <%= link_to image_tag("/assets/close_x.png", alt: "delete_image"), "", onclick: "delete_related_item(this); return false;", class: "del_link lighter_touch" %>
                    <%= link_to image_tag("grey.gif", "data-original"=> image.picture_url(:thumb), alt: "image_thumbnail", class: "lazy thumbnail"), image.picture_url, rel: "facebox" %>
                    <%= hidden_field_tag "images[]", image.id.to_s %>
                </div>
            <% end %>
        </div>
        <div class="clearfix"></div>
        <div class="field">
             <b><%= f.label :tags_string, t("tags.tags") %></b>
             <%= f.text_field :tags_string, 'data-pre' => (f.object.tags ? f.object.tags.map { |t| { :id => t, :name => t }} : []).to_json, class: "tags_input" %>
        </div>
        <%= render "tags/tags_options" %>
        <% if current_user_has_permission? :editor %>
            <%= render "shared/text_field", :f => f, :label => t("general.priority"), :field => :priority %>
        <% end %>
        <div class= "mt10"><%= f.submit t("general.submit"), class: "button", id: "submit_desire" %> </div>
    <% end %>
</div>