<%= stylesheet_link_tag "upload" %>

<div id="desire_fields">
    <%= form_for @desire do |f| %>
        <%= render "shared/error_messages", target: @desire %>

        <div class="grid_7">
            <div id="upload_area" class="img_frame"  >
                <%= hidden_field_tag "authenticity_token", form_authenticity_token, :id => "tokentag" %>
                <% if @desire.new_record? %>
                    <div id="desire_uploader"></div>
                    <div id="upload_spinner" class="display_none" align="center" ><%= image_tag "loading_big.gif", width: 64, height: 64 %></div>
                    <div id="images_container"align="center"></div>
                <% else %>
                    <div id="images_container"align="center">
                      <div class="uploaded_image"><%= image_tag @desire.get_image_url %></div>
                    </div>
                <% end %>
            </div>

            <span class="trivial"><%= "添点描述，让它变得更诱人吧：" %></span><br/>
            <%= f.text_area :content, :maxlength => get_max_length(@desire, :content), 'data-comment_max_len' => get_max_length(@desire, :content), :class => "char_aware" %>
            <%= content_tag :span, "", class: "char_saver display_none" %>
            <%= content_tag :span, "", class: "char_counter block trivial" %>

            <% if current_user_has_permission? :editor %>
                <%= render "shared/text_field", :f => f, :label => t("general.priority"), :field => :priority %>
            <% end %>

            <% if @place %>
                <div>
                    <span class="trivial"><%= "城市：" %></span><span class="trivial"><%= "上海" %></span><br/>
                    <%= hidden_field_tag "place[city]", "上海" %>
                    <span class="trivial"><%= "名称：" %></span><span class="trivial"><%= @place.name %></span><br/>
                    <%= hidden_field_tag "place[name]", @place.name %>
                    <span class="trivial"><%= "地址：" %></span><span class="trivial"><%= @place.street %></span><br/>
                    <%= hidden_field_tag "place[street]", @place.street %>
                </div>
            <% else %>
                <%= content_tag :span, "有地址？那赶快告诉大家在哪能吃到这份美食", class: "trivial" %><%= link_to_function "+展开", '$(this).next().toggle();' %>
                <div class="display_none">
                    <span class=""><%= "城市" %></span><br/>
                    <span class="trivial"><%= "上海（暂时仅限上海，其他城市也会陆续添加～）" %></span><br/>
                    <%= hidden_field_tag "place[city]", "上海" %>
                    <span>名称</span><%= mark_required Place, :name %><span class="trivial">例如： XX饭店</span><br/>
                    <%= text_field_tag "place[name]", "" %><br/>
                    <span>地址</span><%= mark_required Place, :street %><span class="trivial">例如：  黄浦区XX路XXX号 A大厦...</span><br/>
                    <%= text_field_tag "place[street]", "" %><br/>
                </div>
            <% end %>

            <div class= "mt10"><%= f.submit (f.object.new_record? ? t("general.publish") : t("general.change")), class: "#{f.object.new_record? ? "btn submit_post" : "btn submit_update"}", id: "submit_desire" %> </div>
        </div>

        <div class="fl display_inline" style="width:400px;">
            <div class="field">
                 <%= f.label :tags_string, t("tags.tags") %>
                 <%= f.text_field :tags_string, 'data-pre' => (f.object.tags ? f.object.tags.map { |t| { :id => t, :name => t }} : []).to_json, class: "tags_input" %>
            </div>
            <%= render "tags/tags_options" %>
        </div>

        <div class="clearfix"></div>
    <% end %>
</div>

<%= javascript_tag "setup_desire_img_uploader();" %>