<div class="mb20">
  <div class="clearfix">
    <%= render "product_nav", :product => @product %>

    <div class="grid_9 box_shadow to_left p5">
      <div class="img_frame fl">
        <%= link_to image_tag(@product.image.picture_url, :class=>"product_img_box") if @product.image && @product.image.picture_url %>
      </div>

      <div class="product_detail_box fl">
        <p>
          <b><%= t("general.name") %></b>
          <%= @product.name %>
        </p>

        <p>
          <b><%= t("products.price") %></b>
          <%= [t("money.yuan_mark2"), @product.price_as_money_string].join if @product.price %>
        </p>

        <p>
          <b><%= t("catalogs.catalog") %></b>
          <%= @product.catalogs.map(&:name).join(" ") %>
        </p>

        <p>
          <b><%= t("tags.tags") %></b>
          <%= render "shared/show_tags", :item => @product %>
        </p>

        <p>
          <b><%= t("vendors.vendor") %></b>
          <%= new_tab_link_to @product.vendor.name, @product.vendor %>
        </p>


        <div class="m5">
           <%= render "shared/follow_field", :target => @product %>
           <%= link_to t("products.go_to_buy"), {:controller => "home", :action => "gateway", :url => @product.url}, :class => "button"%><br/>
        </div>

        <div class="m5">
          <% if current_user_has_permission? :administrator %>
              <%= link_to t("general.change"), edit_product_path(@product), :class => "button" %>
              <%= link_to t("general.delete"), @product, :confirm => t("general.are_you_sure_to_delete"), :method => :delete, :class => "button" %>
          <% end %>
        </div>
      </div>

      <% if @product.description.present? %>
          <div class="clearfix">
            <h2 align="center"><b><%= t("products.description") %></b></h2>

            <div class="product_desc_box">
                <%= raw @product.description  %>
            </div>
          </div>
      <% end %>
    </div>

    <div class="grid_3 box_shadow to_right">
      <p class="maintitle"><span class="bigfs">您可能还爱吃？</span></p>

      <div class="related_product_block">
        <% @related_products.each do |product| %>
            <li>
              <%= render "related _product", :product => product %>
            </li>
        <% end %>
      </div>

    </div>
  </div>
</div>

<% if current_user_has_permission? :normal_user %>
  <div class="grid_9 to_left">
    <%= render "reviews/review_fields", :review => @product.reviews.new %>
  </div>
<% end %>

<div class="grid_12 to_left to_right">
    <%= render "shared/waterfall", :path => more_reviews_path(product_id: @product.id), :waterfall_partial => "reviews/review_waterfall", :columns_count => 4, :columns_width => 230 %>
</div>
