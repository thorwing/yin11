<%= form_for @review, :html => { :multipart => true } do |f| %>
    <%= render "shared/error_messages", :target => @review %>
    <div class="field">
        <b><%= f.label :title, t("general.title") %><%= mark_required(@review, :title) %><%= mark_required_length(@review, :title) %></b><br/>
        <%= f.text_field :title, :maxlength => get_max_length(@review, :title) %>
    </div>
    <br/>

    <div class="block round">
        <b><%= f.label :tags_string, t("reviews.what") %></b><%= content_tag(:span, t("reviews.what_tip"), :class => "trivial") %><br/>
        <%= f.text_field :tags_string, 'data-pre' => (@review.tags ? @review.tags.map { |t| { :id => t, :name => t }} : []).to_json %>
    </div>

    <div class="block round">
        <b><%= t("reviews.where") %></b><br/>
        <div id="location_fields">
            <% if @review.vendor %>
                <%= render "vendor_fields", :vendor => @review.vendor %>
            <% else %>
                  <%= current_city.name %><%= hidden_field_tag "review[city]", current_city.name %>
                  <%= f.text_field :street %>
                  <br/>
                  <%= link_to t("reviews.choose_vendor"), browse_vendors_path(:popup => true), :rel => "facebox" %>
            <% end %>
        </div>
     </div>

    <div class="block round">
        <b><%= f.label :reported_on_string, t("reviews.when") %></b><br/>
        <%= f.text_field :reported_on_string, {:class => "date_picker"} %>
    </div>


    <div class="block round">
        <b><%= f.label :faults, t("reviews.whats_wrong") %></b><br/>
        <div class="checkbox_group">
            <% FaultTypes.get_values.each_with_index do |type, i| %>
                <%= check_box_tag "review[faults][]", type, @review.faults.include?(type), {:id => "review_faults_#{i}", :class => "checkbox" } %>
                <%= label_tag "review_faults_#{i}", type %>
            <% end %>
        </div>
    </div>

    <%= render "images/images_fields", :f => f, :item => @review %>

    <b><%= f.label :content, t("reviews.content") %><%= mark_required(@review, :content) %><%= mark_required_length(@review, :content) %></b><br/>
    <%= f.text_area :content, :maxlength => get_max_length(@review, :content) %>


    <div class="actions">
        <%= f.submit t("general.submit"), :class => "button" %>
    </div>
<% end %>

<%= render "info_items/delay_load_stuff", :item => @review %>
