<% content_for :header_including do %>
    <%= stylesheet_link_tag "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/themes/redmond/jquery-ui.css" %>
<% end %>

<%= form_for @review, :html => { :multipart => true } do |f| %>
    <%= render "shared/error_messages", :target => @review %>
    <div class="field">
        <b><%= f.label :title, t("general.title") %><%= mark_required(@review, :title) %><%= mark_required_length(@review, :title) %></b><br/>
        <%= f.text_field :title, :maxlength => get_max_length(@review, :title) %>
    </div>

    <div class="field">
        <b><%= f.label :reported_on_string, t("reviews.when") %></b><br/>
        <%= f.text_field :reported_on_string, {:class => "date_picker"} %>
    </div>

    <div class="field">
        <b><%= t("reviews.where") %></b><br/>
        <% if @review.vendor %>
            <div><%= render "vendors/vendor_fields", :target => @review %></div>
        <% else %>
        <div id="vendor_fields">
          <div class="left_column">
            <%= f.text_field :vendor_token, 'data-pre' => (@review.vendor ? [{:id => @review.vendor.id, :name => @review.vendor.full_name }] : []).to_json %>
          </div>

          <%= content_tag(:span, t("vendors.not_found"), :class => "trivial") %>
          <%= link_to t("vendors.not_found_new"), new_vendor_path(:popup => true), :rel => "facebox" %>
         </div>
        <% end %>
    </div>

    <div class="field">
        <b><%= f.label :tags_string, t("reviews.what") %></b><%= content_tag(:span, t("reviews.what_tip"), :class => "trivial") %><br/>
        <%= f.text_field :tags_string, 'data-pre' => (@review.tags ? @review.tags.map { |t| { :id => t, :name => t }} : []).to_json %>
    </div>

    <div class="field">
        <b><%= f.label :faults, t("reviews.whats_wrong") %></b><br/>
        <div class="checkbox_group">
            <% FaultTypes.get_values.each_with_index do |type, i| %>
                <% check_fault(type, i) %>
            <% end %>
        </div>

        <span class="<%= "severity #{get_severity_of(@review)}" %>"></span>
    </div>

    <%= render "images/images_fields", :f => f, :item => @review %>

    <b><%= f.label :content, t("reviews.content") %><%= mark_required(@review, :content) %><%= mark_required_length(@review, :content) %></b><br/>
    <%= f.text_area :content, :maxlength => get_max_length(@review, :content), :class => "char_aware" %><br/>
    <%= content_tag :span, "", :class => "char_counter" %>

    <div>
      <%= check_box_tag :sync_to_sina %><%= label_tag :sync_to_sina, t("syncs.sync_to_sina") %>
    </div>
    <div class="actions">
        <%= f.submit t("general.submit"), :class => "button" %>
    </div>
<% end %>

<%= render "info_items/delay_load_stuff", :item => @review %>
