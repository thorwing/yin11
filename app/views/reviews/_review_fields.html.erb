<%= stylesheet_link_tag "upload" %>

<%= form_for review, :html => { :multipart => true } do |f| %>
    <div class="block round p5 clearfix" id = "review_fields" >
        <!--hidden attributes-->
        <%= (hidden_field_tag "review[desire_id]", review.desire_id) %>
        <%= (hidden_field_tag "review[album_ids][]", @album.id) if @album %>

        <h2>
            <% if defined?(caption) && caption.present? %>
                <%= caption %>
            <% else %>
                <%= t("reviews.head") %>
            <% end %>
        </h2>
        <%= f.text_area :content, :maxlength => get_max_length(review, :content), 'data-comment_max_len' => get_max_length(review, :content), :class => "char_aware" %>
        <%= content_tag :span, "", class: "char_saver display_none" %>
        <%= content_tag :span, "", class: "char_counter block trivial" %>

        <div>
            <span class="fl mr5">添加：</span>
            <!--image uploader-->
            <div class = "fl">
                <%= hidden_field_tag "authenticity_token", form_authenticity_token, :id => "tokentag" %>
                <div id="uploader" class="fl mr10"></div>
                <div id="upload_spinner" style="display:none" ><%= image_tag "loading_big.gif", width: 24, height: 24 %></div>
            </div>

            <!--product linker-->
            <% if review.product_ids.empty? %>
                <div class="fl mr10">
                    <%= link_to_function image_tag("add_product.png", border: 0, width: 50, height:22), "link_product()", class: "lighter_touch"%>
                </div>
            <% else %>
                <%= hidden_field_tag "review[product_ids][]", review.product_ids.first %>
            <% end %>

            <!--recipe linker-->
            <% if review.recipe_ids.empty? %>
                 <div class="fl mr10">
                    <%= link_to_function image_tag("add_recipe.png", border: 0, width: 50, height:22), "link_recipe()", class: "lighter_touch"%>
                </div>
            <% else %>
                <%= hidden_field_tag "review[recipe_ids][]", review.recipe_ids.first %>
            <% end %>


            <!--submit and sync to 3rd-->
            <div class = "fr">
                <% unless current_user.provider == SELF_PROVIDER %>
                    <div class="fl">
                        <div class= "fl m5"><%= check_box_tag  :sync_to %><%= label_tag :sync_to, t("syncs.sync_to") %></div>
                        <div class= "fl m5">
                            <%= link_to image_tag("third_party/#{current_user.provider}.png", :border => 0, :alt => t("syncs.sites.#{current_user.provider}"))%>
                        </div>
                    </div>
                <%end%>
                <div class= "fr m5"><%= f.submit t("reviews.submit"), id: "submit_review_btn", class: "btn submit_post" %> </div>
            </div>
       </div>
       <div id="images_container" class="block fl m5" >
       </div>
    </div>
<% end %>


<%= render "reviews/product_linker" %>
<%= render "reviews/recipe_linker" %>

<%= javascript_tag "setup_review_img_uploader();" %>