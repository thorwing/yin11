<%= stylesheet_link_tag "upload" %>

<%= form_for review, :html => { :multipart => true }, :remote => true do |f| %>
    <div class="block round p5 clearfix" id = "review_dialog" >
        <h2><%= t("reviews.head") %></h2>
        <%= f.text_area :content, :maxlength => get_max_length(review, :content), 'data-comment_max_len' => get_max_length(review, :content), :class => "char_aware" %>
        <%= content_tag :span, "", class: "char_saver display_none" %>
        <%= content_tag :span, "", class: "char_counter block trivial" %>

        <div>
            <span class="fl mr5">添加：</span>
            <!--image uploader-->
            <div class = "fl">
                <%= hidden_field_tag "authenticity_token", form_authenticity_token, :id => "tokentag" %>
                <div id="uploader" class="fl mr10"></div>
                <div id="upload_spinner" style="display:none" ><%= image_tag "loading.gif", width: 16, height: 16 %></div>
            </div>

            <!--product linker-->
            <% if review.product_ids.empty? %>
                <div class="fl mr10">
                    <%= link_to_function image_tag("add_product.png", border: 0, width: 24, height:24), "link_product()", class: "lighter_touch"%>
                </div>
            <% else %>
                <%= hidden_field_tag "review[product_ids][]", review.product_ids.first %>
            <% end %>

            <!--recipe linker-->
            <% if review.recipe_ids.empty? %>
                <div class="fl mr10">
                    <%= link_to_function image_tag("add_recipe.png", border: 0, width: 24, height:24), "link_recipe()", class: "lighter_touch"%>
                </div>
            <% else %>
                <%= hidden_field_tag "review[recipe_ids][]", review.recipe_ids.first %>
            <% end %>

            <!--submit and sync to 3rd-->
            <div class = "fr">
                <% unless current_user.provider == SELF_PROVIDER %>
                    <div class="fl">
                        <div class= "fl m5"><%= check_box_tag  :sync_to %><%= label_tag :sync_to, t("syncs.sync_to") %></div>
                        <div class= "fl m5">
                            <%= link_to image_tag("third_party/#{current_user.provider}_24.png", :border => 0, :alt => t("syncs.sites.#{current_user.provider}"))%>
                        </div>
                    </div>
                <%end%>
                <div class= "fr m5"><%= f.submit t("reviews.submit"), :class => "button" %> </div>
            </div>
       </div>
       <div id="images_container" class="block fl m5" >
       </div>
    </div>
<% end %>


 <div id="product_linker" class="display_none">
    <%= form_tag url_for(controller: "reviews", action: "link", method: :post), :remote => true do %>
        <p><%= "将网上的美食的地址粘帖在下方框中即可：" %></p>
        <%= text_field_tag "product_url", "" %>
        <%= submit_tag t("general.submit"), id: "link_prod_btn", class: "button", onclick: '$("#link_spinner").show();' %>
        <div id="link_spinner" style="display:none" ><%= image_tag "loading.gif", width: 16, height: 16 %></div>
        <p>已支持以下网上商城：</p>
        <div>
          <%= link_to image_tag("third_party/taobao.png") + "淘宝", "http://www.taobao.com/" %>
        </div>
    <% end %>
</div>
