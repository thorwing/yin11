<div class="grid_9 box_shadow">
    <div class="p5">
        <div class="fl">
            <%= link_to image_tag(@recipe.get_image_url(:waterfall), alt: @recipe.name, class: 'img_frame overflow_hidden'), @recipe.get_image_url, rel: "facebox"  %>
        </div>

        <div class="fl f16 ml10">
            <h2><%= @recipe.name %></h2>
            <span class="trivial"><%= t("recipes.uploaded_by") + ": " + @recipe.author.screen_name %></span> <br/>
            <%= t_with_colon("recipes.ingredients") %><br/>
            <p>
              <% @recipe.ingredients.each do |i|%>
                  <% if i.is_major_ingredient == true %>
                      <%= i.name %>
                      <%= i.amount %>
                      <span class="trivial"><%= i.is_major_ingredient ? t("recipes.major") : t("recipes.minor") %></span>
                      <br/>
                  <% end  %>
              <% end %>
              <% @recipe.ingredients.each do |i|%>
                  <% if i.is_major_ingredient == false %>
                      <%= i.name %>
                      <%= i.amount %>
                      <span class="trivial"><%= i.is_major_ingredient ? t("recipes.major") : t("recipes.minor") %></span>
                      <br/>
                  <% end  %>
              <% end %>
            </p>
            <% if current_user_has_permission? :normal_user %>
                <div class="mt5">
                    <%= link_to t("recipes.want"), "", class: "mark_recipe button", "data-behavior" => "want", "data-msg" => "我#{t("recipes.want")}#{@recipe.name}" %>
                    <%= link_to t("recipes.did"), "", class: "mark_recipe button", "data-behavior" => "did", "data-msg" => "我#{t("recipes.did")}#{@recipe.name}"  %>
                    <%= render "relationships/follow_field", :target => @recipe %>
                </div>
            <% end %>
            <% if the_author_himself(Recipe.name, @recipe.id, true, false) %>
                <div class="mt5">
                    <%= link_to t("general.edit"), edit_recipe_path(@recipe), class: "button" %>
                </div>
            <% end %>
        </div>
    </div>

    <div class="steps_show grid_9 ">
        <p>
          <b><%= t("recipes.steps") %></b>
          <% @recipe.steps.each do |f|%>
              <div class="step_container grid_3 ">
                  <% if f.image.present?%>
                    <%= link_to image_tag(f.get_image_url(:thumb), :alt=> "step_image"), f.get_image_url, rel: "facebox" %><br/>
                  <% end  %>
                <div class="step_content"><%= f.content %></div>
              </div>
          <% end %>
        </p>
    </div>
</div>


<div class = "grid_3 box_shadow to_right"  >
  <%= render "products/related_products", products: @related_products %>
</div>

<div id="review_linker" class="display_none">
    <%= form_tag url_for(controller: "recipes", action: "mark", id: @recipe.id, method: :post), :remote => true do %>
        <%= hidden_field_tag "behavior", "", id: "behavior" %>
        <span>顺便说两句吧</span>
        <p>
          <%= text_area_tag "content", "", :rows => 10, :columns => 30, :maxlength => get_max_length(Review, :content), 'data-comment_max_len' => get_max_length(Review, :content), :class => "char_aware" %>
          <%= content_tag :span, "", class: "char_saver display_none" %>
          <%= content_tag :span, "", class: "char_counter block trivial" %>
        </p>
        <%= submit_tag t("general.submit"), class: "button" %>
    <% end %>
</div>
