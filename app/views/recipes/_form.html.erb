<div id="recipe_form" class="mt10">
    <%= form_for(@recipe) do |f| %>
        <%= render "shared/error_messages", target: @recipe %>
        <div class="box_shadow clearfix">
            <div class = "grid_6">
                <div class="field">
                    <b><%= f.label :name, t("recipes.name") %></b><%= mark_required(@recipe, :name) %><%= mark_required_length(@recipe, :name) %><br/>
                    <%= f.text_field :name, :maxlength => get_max_length(Recipe, :name) %>
                </div>
                <div  class="field">
                    <b><%= f.label :description, t("recipes.description") %></b><%= mark_required_length(@recipe, :description) %><br/>
                    <%= f.text_area :description, :maxlength => get_max_length(Recipe, :description), 'data-comment_max_len' => get_max_length(Recipe, :description), rows: 3, :class => "char_aware " %>
                    <%= content_tag :span, "", class: "char_saver display_none" %>
                    <%= content_tag :span, "", class: "char_counter block trivial" %>
                </div>
                <div class="ingredients mt5 mb5 clearfix">
                    <div class ="major_ingredients">
                        <b><%= t("recipes.major") %></b><br/>
                        <div>
                            <table>
                                <tr>
                                    <th><%= t("recipes.ingredient_name") %><%= mark_required_length(Ingredient, :name) %></th>
                                    <th><%= t("recipes.ingredient_amount") %></th>
                                    <th></th>
                                </tr>
                                <%= f.fields_for :ingredients  do |builder| %>
                                    <% if builder.object.is_major_ingredient == true %>
                                        <%= render "ingredient_fields", :f => builder %>
                                    <% end %>
                                <% end  %>
                            </table>
                        </div>

                        <%= link_to_add_fields( "+添加主料", f, :ingredients, ".major_ingredients table", ".ingredients" , get_max_length(Recipe, :ingredients), "btn btn_add_major_ingredient")  %>
                    </div>

                    <div class ="minor_ingredients mt10">
                        <b><%= t("recipes.minor") %></b><br/>
                        <div>
                            <table>
                                <tr>
                                    <th><%= t("recipes.ingredient_name") %><%= mark_required_length(Ingredient, :name) %></th>
                                    <th><%= t("recipes.ingredient_amount") %></th>
                                    <th></th>
                                </tr>

                                <%= f.fields_for :ingredients  do |builder| %>
                                    <% if builder.object.is_major_ingredient == false %>
                                        <%= render "ingredient_fields", :f => builder %>
                                    <% end  %>
                                <% end  %>
                            </table>
                        </div>

                        <%= link_to_add_fields( "+添加辅料", f, :ingredients, ".minor_ingredients table", ".ingredients" , get_max_length(Recipe, :ingredients), "btn btn_add_minor_ingredient")  %>
                    </div>
                </div>
            </div>
            <div class="fl display_inline" style="width:400px;">
               <div class="field">
                       <b><%= f.label :tags_string, t("tags.tags") %></b>
                       <%= f.text_field :tags_string, 'data-pre' => (f.object.tags ? f.object.tags.map { |t| { :id => t, :name => t }} : []).to_json, class: "tags_input" %>
                  </div>
                  <%= render "tags/tags_options" %>
            </div>
        </div>

        <div class="steps box_shadow clearfix mt10 p10">
            <ul id="sortable" class ="block ">
                <b><%= f.label :title, t("recipes.steps"), :class => "f16" %></b><br/>
                <%= f.fields_for :steps  do |builder| %>
                    <%= render "step_fields", :f => builder %>

                    <%=  javascript_tag "setup_step_img_uploader(\'.steps\');"%>
                    <% if builder.object.new_record? %>
                           <%= javascript_tag "change_back_img(\'.steps\');" %>
                    <% else %>
                        <% url = (builder.object.img_id && builder.object.image) ?  builder.object.image.picture_url(:thumb) : "" %>
                        <% if url.blank?  %>
                            <%= javascript_tag "change_back_img(\'.steps\');" %>
                        <% else %>
                            <%= javascript_tag "change_back_img(\'.steps\',"+"'"+ url +"');" %>
                        <% end  %>
                    <% end  %>

                <% end %>
            </ul>

            <% add_class= "btn btn_add_step" %>
            <%= link_to_add_fields( "", f, :steps, ".steps >ul", ".steps", get_max_length(Recipe, :steps), add_class ) %><br/>


            <%= f.label :title, t("recipes.note"), :class => "f14 mt5" %>
        </div>

        <div class="mt10">
          <%= f.submit (f.object.new_record? ? t("general.publish") : t("general.change")), class: "#{f.object.new_record? ? "btn submit_post" : "btn submit_update"}", id: "recipe_submit" %>
        </div>
     <% end %>
</div>