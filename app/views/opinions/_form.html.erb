<%= form_for opinion, :html => { :multipart => true } do |f| %>
  <%= render "shared/error_messages", :target => opinion %>
  <div class="field">
    <%= f.label :title, t("general.title") %><%= mark_required(opinion, :title) %><%= mark_required_length(opinion, :title) %><br/>
    <%= f.text_field :title, :maxlength => 40 %>
  </div>
  <div class="field">
    <%= f.label :food_tokens, t("foods.foods") %><br/>
    <%= f.text_field :food_tokens, 'data-pre' => (f.object.foods.map { |f| { :id => f.id, :name => f.name }}).to_json %>
  </div>
  <div id="field">
    <%= f.label :vendor_token, t("vendors.vendor") %>
    (<%= t("vendors.vendor_not_found") %> <%= link_to t("vendors.quick_create_vendor"), new_vendor_path(:popup => true), :rel => "facebox" %>)<br/>
    <%= content_tag(:span, current_city.name, :id => "current_city_name") %>(<%= link_to t("address.change_city"), profile_edit_current_city_path(:popup => true), :rel => "facebox" %>)
    <%= f.text_field :vendor_token, 'data-pre' => (f.object.vendor ? [{ :id => f.object.vendor.id, :name => f.object.vendor.name }] : []).to_json %>
  </div>
  <div class="field">
    <%= f.label :reported_on_string, t("general.date") %><br/>
    <%= f.text_field :reported_on_string, {:class => "date_picker"} %>
  </div>


  <% if false %>
      <div class="fields_group">
        <%= f.fields_for :checkpoints do |builder| %>
            <%= render "checkpoint_fields", :f => builder %>
        <% end %>
        <p><%= link_to_add_fields  t("reviews.add_checkpoint"), f, :checkpoints %></p>

        <%= f.label :severity, t("reviews.severity") %><br/>

        <div class="radio_group">
            <%= f.radio_button(:severity, 0, :checked => opinion.severity == 0, :class => "severity_radio") %><label for="review_severity_0"> <%= t("reviews.severity_0") %></label>
            <%= f.radio_button(:severity, 1, :checked => opinion.severity == 1, :class => "severity_radio") %><label for="review_severity_1"> <%= t("reviews.severity_1") %></label>
            <%= f.radio_button(:severity, 2, :checked => opinion.severity == 2, :class => "severity_radio") %><label for="review_severity_2"> <%= t("reviews.severity_2") %></label>
            <%= f.radio_button(:severity, 3, :checked => opinion.severity == 3, :class => "severity_radio") %><label for="review_severity_3"> <%= t("reviews.severity_3") %></label>
	    </div>
        <div>
            <label class="severity_image severity_<%= opinion.severity %>"></label>
        </div>

      </div>
  <% end %>

  <%= f.label :images, t("images.images") %>
  <%= mark_required(opinion, :images) %>
  <%= content_tag(:span, t("reviews.upload_image_tip"), :class => "trivial" ) if opinion.is_a?(Review) %>

  <%= hidden_field_tag "images_counter", opinion.images ?  opinion.images.size : 0, 'data-max' => 5 %>
  <div class="fields_group">
      <% opinion.images.each do |image| %>
        <%= render "images/image", :image => image %>
      <% end %>
      <div class="images"></div>
      <div id="image_upload_container">
        <div id="image_upload"></div>
      </div>
  </div>

  <noscript>
    <p><%= t("general.javascript_please") %></p>
  </noscript>

  <% if false %>
  <% tab_control do %>
    <div class="tab_header">
    <ul>
        <%= local_tab_page( t("vendors.vendor"), true) do %>
            <div id="field">
                <%= f.label :vendor_token, t("vendors.vendor") %>
                <%= f.text_field :vendor_token, 'data-pre' => (f.object.vendor ? [{ :id => f.object.vendor.id, :name => f.object.vendor.name }] : []).to_json %>
            </div>
        <% end %>
        <%= local_tab_page( t("vendors.non_existed_vendor")) do %>
            <div id="new_vendor">
                <%= t("reviews.quick_create_vendor") %>
                 <div class="field">
                    <%= f.label :vendor_name, t("general.name") %><br />
                    <%= f.text_field :vendor_name %>
                </div>
                <div class="field">
                    <%= f.label :vendor_city, t("address.city") %><br />
                    <%= f.select :vendor_city, options_for_select(get_cities_for_select, opinion.vendor_city)%>
                </div>
                <div class="field">
                    <%= f.label :vendor_street, t("address.street") %><br />
                    <%= f.text_field :vendor_street %>
                </div>
            </div>
        <% end %>
    </ul>
    </div>
    <% tab_content do %>
    <% end %>
  <% end %>
  <% end %>

  <div class="field">
    <%= f.label :content, t("reviews.content") %><%= mark_required(opinion, :content) %><%= mark_required_length(opinion, :content) %><br/>
    <%= f.text_area :content, :class => "mceEditor", :maxlength => 10000 %>
  </div>

  <div class="actions">
    <%= f.submit t("general.submit"), :class => "button" %>
  </div>
<% end %>

<%= javascript_include_tag '/uploadify/swfobject.js', '/uploadify/jquery.uploadify.v2.1.4.min.js' %>
<%= image_uploadify %>